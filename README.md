# Pixiv Discovery Anti-Reload

ブラウザ版Pixivの「ディスカバリー」画面で、ブラウザバック時に作品リストがリロードされてしまうのを防止し、スクロール位置を復元するためのTampermonkeyユーザースクリプトです。

## 機能

*   **作品リストの維持**: ディスカバリーページで読み込まれた作品データ（APIレスポンス）をキャッシュし、ブラウザバック時に再利用することで、見ていた作品が消えるのを防ぎます。
*   **スクロール位置の復元**: ページ遷移前のスクロール位置を正確に復元します。
*   **スムーズな復帰**: 戻ってきてから一定時間はキャッシュを使用し、その後は通常の無限スクロール（新規取得）に移行します。
*   **リロード検知**: F5キーなどでページをリロードした場合は、キャッシュをクリアして新しい作品を表示します。

## インストール方法

1.  [Tampermonkey](https://www.tampermonkey.net/) ブラウザ拡張機能をインストールします。
2.  Tampermonkeyのダッシュボードで「新規スクリプトを追加」を選択します。
3.  `pixiv-discovery-anti-reload.user.js` の内容をコピー＆ペーストして保存します。

## 更新履歴 (Changelog)

### v1.6.0
*   **スクロール挙動の修正**: スクロール位置の復元が繰り返し発生し、操作を妨げる問題を修正しました（復元処理を一度だけに制限）。
*   **リロード時のキャッシュクリア**: ページをリロード（F5等）した際、古いキャッシュが残って同じ作品が表示され続ける問題を修正しました。
*   **無限スクロールの復帰**: ブラウザバック後、一定時間経過すると無限スクロールが機能しなくなる問題を修正しました。

### v1.5.0
*   **キャッシュ制御の改善**: 一度キャッシュを使用した後にフラグが正しくリセットされず、以降のAPIリクエストが失敗する問題を修正しました。
*   **復元期間の導入**: 戻ってきてから数秒間（`RESTORE_WINDOW`）は、強制的にキャッシュを使用するように変更しました。

### v1.3.0
*   **ナビゲーション検知の強化**: `popstate` イベントの監視を強化し、ブラウザバックの検出精度を向上させました。

### v1.0.0
*   初期リリース：基本的なAPIキャッシュとスクロール位置の保存・復元機能を実装。

## 技術的な詳細

- `window.fetch` をフックしてDiscovery APIのレスポンスをインターセプト
- `sessionStorage` を使用して作品データとスクロール位置を一時保存
- `History API` (`pushState`, `popstate`) と `Performance Navigation Timing` APIを利用した高度な状態管理

## ライセンス

MIT License
